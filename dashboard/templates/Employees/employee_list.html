
{% extends "app/base_site.html" %}
{% load static i18n %}
{% load humanize %}
{% block content %}
<head>
  <title>UCC Bwaise | Employee List as of  {{mth}} {{year}}</title>
</head>
<div class="right_col" role="main">
    <div class="row">
        <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                    <div class="x_title">
                        <h1 style="text-align: center;"><i class="fa fa fa-calendar-check-o"></i><b>EMPLOYEE MODULE</b></h1>
                        <ul class="nav navbar-right panel_toolbox">
                            <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                            </li>
                        </ul>
                        <div class="clearfix"></div>
                    </div>
                    
                    
                 
          <div class="x_content">
            <div class="" data-example-id="togglable-tabs">
                <ul class="nav nav-tabs bordered">
                    <li role="presentation"  class="active"><a href="{% url 'employee-list' %}"><i
                                class="fa fa-list-ol"></i> Employee List</a>
                    </li>
                    <li role="presentation"><a href="{% url 'employee-register' %}"><i
                                class="fa fa-plus-square-o"></i> Add Employees</a>
                     </li>
                    <li role="presentation"><a href="{% url 'current-month-salaries' %}"><i
                                class="fa fa-plus-square-o"></i> Salaries Paid Report</a>
                     </li>
                    <li role="presentation"><a href="{% url 'salariespaidarchivessearch' %}"><i
                                class="glyphicon glyphicon-king"></i> Archived Salaries Paid Report</a>
                     </li>
                </ul>
                <h1 style="text-align: center;">Employee List as of the Month of {{mth}}</h1>
                <div class="separator"></div>
               <div class="tab-content">
                 <div class="tab-pane fade in active">
                    <div class="x_content">                     
                      <table id="employees-table" class="table table-striped table-bordered" cellspacing="0" width="100%">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Role</th>
                                    <th>Net Salary</th>
                                    <th>Balance</th>
                                    <th>Salary Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                              <tr>
                                {% for emp in employees %}
                                     <td>{% if emp.UCC_Bwaise_Member == 'Yes' %}
                                     {{ emp.Church_Member}}
                                     {% else %}
                                     {{ emp.full_name}}
                                     {% endif %}
                                    </td>
                                     <td>{{ emp.Role}}</td>
                                     <td>{{ emp.Salary_Amount|intcomma}}</td>
                                     <td>{{ emp.Balance|intcomma}}</td>
                                     <td> {% if emp.total_salary_paid >= emp.Salary_Amount %}
                                        <b class="btn btn-btn btn-sm "><span class="glyphicon glyphicon-thumbs-up"></span> CURRENT MONTH PAID </b>
                                        {% elif emp.total_salary_paid > 0 and emp.total_salary_paid != emp.Salary_Amount %}
                                        <a href="{% url 'pay-employee' pk=emp.id %}"class="btn btn-warning btn-sm "><span class="glyphicon glyphicon-euro"></span> Pay Balance</a>
                                        {% else %}
                                        <a href="{% url 'pay-employee' pk=emp.id %}"class="btn btn-info btn-sm "><span class="glyphicon glyphicon-euro"></span> Pay Salary</a>
                                        {% endif %}
                                      </td>
                                      
                                     <td>
                                     <div class="mb-4">
                                        <button type="button" class="btn btn-primary btn-sm js-view-employees" data-url="{% url 'view-employee' emp.id %}">
                                          <span class="glyphicon glyphicon-eye-open"></span> View
                                        </button>
                                         <!-- <a href="{% url 'view-employee' emp.pk %}" class="btn btn-primary btn-sm">
                                            <span class="glyphicon glyphicon-eye-open"></span> View
                                         </a> -->
                                        <a href="{% url 'edit-employee' pk=emp.id %}"class="btn btn-success btn-sm"><span class="glyphicon glyphicon-edit"></span> Edit</a>
                                         <button type="button" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#myModal">
                                             <span class='glyphicon glyphicon-trash'> </span> Delete
                                         </button>

                                            <!-- delete Modal -->
                                            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                                              <div class="modal-dialog" role="document">
                                                <div class="modal-content">
                                                  <div class="modal-header">
                                                    <h4 class="modal-title" id="myModalLabel">Delete Employee</h4>
                                                  </div>
                                                  <div class="modal-body">
                                                      <h3>Are you sure you want to delete Employee?</h3>
                                                  </div>
                                                  <div class="modal-footer">
                                                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                                    <a href="{% url 'delete-employee' emp.pk %}" class="btn btn-danger bt-sm" role="button">Confirm</a>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                     </div>   
                                     </td> 
                                </tr>
                                {% endfor%} 
                            </tbody>
                        </table>
                    </div>
                  </div>
                  <!-- THE MODAL WE WILL BE USING -->
                  <div class="modal fade" id="modal-employees">
                    <div class="modal-dialog modal-lg">
                      <div class="modal-content">
                      </div>
                    </div>
                  </div>
               </div>
            </div> 
          </div>
        </div>       
    </div>
</div>
<script type="text/javascript">
  $(document).ready(function () {
    $('#employees-table').DataTable({
      dom: 'Bfrtip',
      iDisplayLength: 15,
      buttons: [
        'copyHtml5',
        'excelHtml5',
        'csvHtml5',
        'pdfHtml5',
        'print',
        'pageLength'
      ],
      search: true,
      responsive: true
    });
  });

  $(function () {
    var loadForm = function () {
        var btn = $(this);
        $.ajax({
            url: btn.attr("data-url"),
            type: 'get',
            dataType: 'json',
            beforeSend: function () {
                $("#modal-employees").modal("show");
            },
            success: function (data) {
                $("#modal-employees .modal-content").html(data.html_form);
            }
        });
    };
    $("#employees-table").on("click", ".js-view-employees", loadForm);
}
);

</script>
 
{% endblock content %}

